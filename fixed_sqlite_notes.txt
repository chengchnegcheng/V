# SQLite.go 文件修复指南

## 问题描述

在 `model/sqlite.go` 文件中存在以下重复声明的方法：

1. `ListProtocolStatsByUserID` 方法在第687行和第2554行有两个不同签名的声明:
   - 第687行: `func (db *SQLiteDB) ListProtocolStatsByUserID(userID int64) ([]*ProtocolStats, error)`
   - 第2554行: `func (db *SQLiteDB) ListProtocolStatsByUserID(userID uint, stats *[]*ProtocolStats) error`

2. `GetAllUsersInternal` 方法在fixed_implementation.go和sqlite.go中重复声明

3. `GetProtocolStatsByUserIDPtr` 方法在fixed_implementation.go和sqlite.go中重复声明

## 修复步骤

### 方法1: 手动编辑文件

1. 打开 `model/sqlite.go` 文件
2. 删除第2553-2557行的重复声明的 `ListProtocolStatsByUserID` 方法:
   ```go
   // ListProtocolStatsByUserID 获取用户的所有协议统计
   func (db *SQLiteDB) ListProtocolStatsByUserID(userID uint, stats *[]*ProtocolStats) error {
       tx := db.db.Where("user_id = ?", userID).Find(stats)
       return tx.Error
   }
   ```

3. 删除第2786-2830行的重复声明的 `GetAllUsersInternal` 方法:
   ```go
   // GetAllUsersInternal 内部方法：获取所有用户
   func (db *SQLiteDB) GetAllUsersInternal(users *[]*User) error {
       // ... 整个方法体 ...
   }
   ```

4. 删除第2831-2837行的重复声明的 `GetProtocolStatsByUserIDPtr` 方法:
   ```go
   // GetProtocolStatsByUserIDPtr 使用指针接收返回值的获取用户协议统计的方法
   func (db *SQLiteDB) GetProtocolStatsByUserIDPtr(userID uint, stats *[]*ProtocolStats) error {
       // ... 整个方法体 ...
   }
   ```

5. 保存文件

### 方法2: 使用文本处理工具

如果你使用Linux或MacOS，可以使用以下命令:

```bash
# 备份原文件
cp model/sqlite.go model/sqlite.go.bak

# 删除重复声明的方法
cat model/sqlite.go | sed '2553,2557d' | sed '2786,2830d' | sed '2831,2837d' > model/sqlite.go.fixed

# 替换原文件
mv model/sqlite.go.fixed model/sqlite.go
```

在Windows PowerShell中:

```powershell
# 备份原文件
Copy-Item model/sqlite.go model/sqlite.go.bak

# 提取文件的各个部分并重新组合
Get-Content model/sqlite.go | Select-Object -First 2552 > model/part1.txt
Get-Content model/sqlite.go | Select-Object -Skip 2558 -First (2786-2558) > model/part2.txt
Get-Content model/sqlite.go | Select-Object -Skip 2830 -First (2831-2830) > model/part3.txt
Get-Content model/sqlite.go | Select-Object -Skip 2837 > model/part4.txt

# 合并各部分
Get-Content model/part1.txt, model/part2.txt, model/part3.txt, model/part4.txt | Set-Content model/sqlite.go.fixed

# 替换原文件
Move-Item -Force model/sqlite.go.fixed model/sqlite.go

# 清理临时文件
Remove-Item model/part1.txt, model/part2.txt, model/part3.txt, model/part4.txt
```

## 验证修复

修复后，确保以下方法只有一个声明:

- `ListProtocolStatsByUserID`: 只保留第687行的实现
- `GetAllUsersInternal`: 只保留fixed_implementation.go中的实现
- `GetProtocolStatsByUserIDPtr`: 只保留fixed_implementation.go中的实现

## 注意事项

1. 确保在修改之前备份原始文件
2. 修改后进行编译测试，确保没有新的错误
3. 如果修改后出现其他问题，可以考虑使用备份文件恢复 